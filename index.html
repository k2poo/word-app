<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff5fb;
  padding:2vw;
}

.screen{ display:none; }

.card{
  background:white;
  padding:3vw;
  border-radius:18px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  margin-bottom:4vw;
}

#topMenu{
  position:fixed;
  top:1vw;
  right:1vw;
  z-index:100;
}

#topMenu button{ margin-left:1vw; }

button{
  padding:2.2vw 3.5vw;
  border-radius:20px;
  border:none;
  font-size:3.5vw;
  margin:1vw;
}

.btn-pink{ background:#ff9bcd; }
.btn-green{ background:#9be1a7; }
.btn-blue{ background:#9bd8ff; }
.btn-gray{ background:#dddddd; }

.big{
  font-size:6vw;
  margin:3vw 0;
  cursor:pointer;
  text-align:center;
}

#wordImage{
  max-width:70%;
  display:none;
  margin:3vw auto;
  cursor:pointer;
}

#infoBar{
  position:fixed;
  bottom:1.5vw;
  right:1.5vw;
  background:rgba(255,255,255,0.9);
  border-radius:12px;
  padding:1.2vw 1.8vw;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  text-align:right;
  z-index:200;
}

#appName{
  font-size:2.2vw;
  color:#ff7eb8;
}

#statusText{
  font-size:2.6vw;
  color:#555;
}

@media (max-width: 600px){
  button{
    font-size:5vw;
    padding:3vw 5vw;
  }
  .big{ font-size:9vw; }
  #appName{ font-size:3vw; }
  #statusText{ font-size:3.8vw; }
}
</style>
</head>

<body>

<div id="topMenu">
  <button class="btn-blue" onclick="pauseStudy()">ä¸­æ–­</button>
  <button class="btn-gray" onclick="confirmEnd()">çµ‚äº†</button>
</div>

<div id="listScreen" class="screen card">
  <h3>ğŸ“š ãƒªã‚¹ãƒˆã‚’é¸ã‚“ã§ã­</h3>
  <div id="listContainer"></div>
</div>

<div id="studyScreen" class="screen card">
  <div class="big" id="questionWord" onclick="speakQuestion()"></div>
  <img id="wordImage" onclick="speakQuestion()">
  <div class="big" id="answerMeaning"
       style="color:#0077ff;"
       onclick="speakAnswer()"></div>

  <button class="btn-green" onclick="markKnow()">åˆ†ã‹ã‚‹</button>
  <button class="btn-pink" onclick="markDontKnow()">åˆ†ã‹ã‚‰ãªã„</button>
</div>

<div id="pauseScreen" class="screen card">
  <h3>â¸ ä¸­æ–­ä¸­</h3>
  <button class="btn-green" onclick="resumeStudy()">å†é–‹</button>
  <button class="btn-gray" onclick="confirmEnd()">çµ‚äº†</button>
</div>

<div id="infoBar">
  <div id="appName">ğŸŒ¸ è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026 ğŸŒ¸</div>
  <div id="statusText"></div>
</div>

<script>
// ===== ãƒªã‚¹ãƒˆå®šç¾©ï¼ˆãƒ•ã‚©ãƒ«ãƒ€å¯¾å¿œï¼‰=====
const lists = [
  { title:"å‹•ç‰©", file:"å‹•ç‰©.csv", level:"åŸºæœ¬", folder:"lists" },
  { title:"ãƒ•ãƒ«ãƒ¼ãƒ„", file:"ãƒ•ãƒ«ãƒ¼ãƒ„.csv", level:"åŸºæœ¬", folder:"lists" },

  { title:"æ—…è¡Œ", file:"æ—…è¡Œ.csv", level:"ä¸­ç´š", folder:"lists2" },
  { title:"ãƒ‹ãƒ¥ãƒ¼ã‚¹", file:"ãƒ‹ãƒ¥ãƒ¼ã‚¹.csv", level:"ä¸­ç´š", folder:"lists2" }
];

let currentList=[], title="", order=[], index=0;
let dontKnow=[], round=1, fullRoundCount=0;

// ===== ç”»é¢åˆ‡æ›¿ =====
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

// ===== CSV èª­ã¿è¾¼ã¿ =====
async function loadCSV(folder, file){
  const res = await fetch(folder + "/" + file);
  const text = await res.text();
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",");
  return lines.slice(1).map(line=>{
    const values=line.split(",");
    let o={};
    headers.forEach((h,i)=>o[h.trim()]=values[i]?.trim());
    return o;
  });
}

// ===== ãƒªã‚¹ãƒˆè¡¨ç¤º =====
function loadLists(){
  const c=document.getElementById("listContainer");
  c.innerHTML="";

  ["åŸºæœ¬","ä¸­ç´š"].forEach(level=>{
    const h=document.createElement("h4");
    h.innerText=level;
    c.appendChild(h);

    lists.filter(l=>l.level===level).forEach(l=>{
      const b=document.createElement("button");
      b.className="btn-blue";
      b.innerText=l.title;
      b.onclick=()=>startStudy(l);
      c.appendChild(b);
    });
  });

  document.getElementById("statusText").innerText="";
  show("listScreen");
}

// ===== å­¦ç¿’é–‹å§‹ =====
async function startStudy(info){
  const csv=await loadCSV(info.folder, info.file);
  currentList=csv.map(x=>({word:x.word,meaning:x.meaning,image:x.image}));

  title=info.level+"ï¼š"+info.title;
  index=0; round=1; fullRoundCount=0; dontKnow=[];
  resetOrder();
  show("studyScreen");
  nextQuestion();
}

function resetOrder(){
  order=[...currentList.keys()].sort(()=>Math.random()-0.5);
  index=0;
}

// ===== å‡ºé¡Œ =====
function nextQuestion(){
  if(index>=order.length){
    fullRoundCount++;

    if(dontKnow.length===0 && confirm("é–“é•ã„ãŒãªããªã‚Šã¾ã—ãŸã€‚\nçµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")){
      loadLists(); return;
    }

    if(fullRoundCount>=3){
      alert("3å›ç¹°ã‚Šè¿”ã—ãŸã®ã§çµ‚äº†ã—ã¾ã™ã€‚");
      loadLists(); return;
    }

    currentList=dontKnow.map(i=>currentList[i]);
    dontKnow=[]; round++; resetOrder();
  }

  const item=currentList[order[index]];
  document.getElementById("questionWord").innerText=item.word;
  document.getElementById("answerMeaning").innerText="";
  document.getElementById("statusText").innerText=`${title}ï¼ˆ${round}å·¡ç›®ï¼‰`;

  const img=document.getElementById("wordImage");
  if(item.image){
    img.src="images/"+item.image;
    img.style.display="block";
  }else{
    img.style.display="none";
  }
}

// ===== å›ç­” =====
function markKnow(){
  document.getElementById("answerMeaning").innerText=currentList[order[index]].meaning;
  speakAnswer();
  setTimeout(()=>{ index++; nextQuestion(); },800);
}

function markDontKnow(){
  dontKnow.push(order[index]);
  document.getElementById("answerMeaning").innerText=currentList[order[index]].meaning;
  speakAnswer();
  setTimeout(()=>{ index++; nextQuestion(); },1700);
}

// ===== ä¸­æ–­ãƒ»çµ‚äº† =====
function pauseStudy(){ show("pauseScreen"); }
function resumeStudy(){ show("studyScreen"); }

function confirmEnd(){
  if(confirm("ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")) loadLists();
}

// ===== éŸ³å£° =====
function speakQuestion(){
  speak(currentList[order[index]].word);
}

function speakAnswer(){
  speak(currentList[order[index]].word);
}

function speak(text){
  if(!text) return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  speechSynthesis.speak(u);
}

// åˆæœŸè¡¨ç¤º
loadLists();
</script>

</body>
</html>
