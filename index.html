<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026</title>

<style>
  
body{
  font-family: Arial, sans-serif;
  background:#fff5fb;
  padding:2vw;
}

.screen{ display:none; }

.card{
  background:white;
  padding:3vw;
  border-radius:18px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  margin-bottom:4vw;
}

button{
  padding:2.5vw 4vw;
  border-radius:20px;
  border:none;
  font-size:4vw;
  margin:1vw;
}

.btn-blue{ background:#9bd8ff; }
.btn-green{ background:#9be1a7; }
.btn-pink{ background:#ff9bcd; }
.btn-gray{ background:#dddddd; }

.big{
  font-size:7vw;
  margin:3vw 0;
  text-align:center;
  cursor:pointer;
}

#wordImage{
  max-width:70%;
  display:none;
  margin:3vw auto;
  cursor:pointer;
}

#infoBar{
  position:fixed;
  bottom:1.5vw;
  right:1.5vw;
  background:rgba(255,255,255,0.9);
  border-radius:12px;
  padding:1.5vw 2vw;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  text-align:right;
}

#appName{
  font-size:2.5vw;
  color:#ff7eb8;
}

#statusText{
  font-size:3vw;
  color:#555;
}

@media (max-width:600px){
  button{ font-size:5vw; }
  .big{ font-size:9vw; }
}
</style>
</head>
  

<body>

<!-- ===== ãƒªã‚¹ãƒˆé¸æŠ ===== -->
<div id="listScreen" class="screen card">
  <h3>ğŸ“˜ åŸºæœ¬</h3>
  <div id="basicList"></div>

  <h3>ğŸ“• ä¸­ç´š</h3>
  <div id="intermediateList"></div>
</div>

<!-- ===== å­¦ç¿’ç”»é¢ ===== -->
<div id="studyScreen" class="screen card">
  <div class="big" id="questionWord" onclick="speakQuestion()"></div>
  <img id="wordImage" onclick="speakQuestion()">
  <div class="big" id="answerMeaning" style="color:#0077ff;"
       onclick="speakAnswer()"></div>

  <button class="btn-green" onclick="markKnow()">åˆ†ã‹ã‚‹</button>
  <button class="btn-pink" onclick="markDontKnow()">åˆ†ã‹ã‚‰ãªã„</button>
  <button class="btn-gray" onclick="endStudy()">çµ‚äº†</button>
</div>

<!-- ===== å³ä¸‹æƒ…å ± ===== -->
<div id="infoBar">
  <div id="appName">ğŸŒ¸ è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026 ğŸŒ¸</div>
  <div id="statusText"></div>
</div>

<script>
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAYEEHtYUdDylKlSwy4mX2S2mIK5Hs3vJA",
  authDomain: "english-word-app-f7101.firebaseapp.com",
  projectId: "english-word-app-f7101",
  storageBucket: "english-word-app-f7101.firebasestorage.app",
  messagingSenderId: "813810211022",
  appId: "1:813810211022:web:79a9f40ed9361ea38d189f",
  measurementId: "G-X57CWZXG7E"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let userId = null;

signInAnonymously(auth).then(res=>{
  userId = res.user.uid;
  console.log("ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ", userId);
});
let studyStartTime = null;

function startStudySession(){
  studyStartTime = Date.now();
}
async function saveStudyLog(listTitle, dontKnowCount){
  if(!userId || !studyStartTime) return;

  const today = new Date().toISOString().slice(0,10);
  const elapsed = Math.floor((Date.now() - studyStartTime) / 1000);

  const ref = doc(db, "users", userId, "learningLogs", today);
  const snap = await getDoc(ref);

  if(snap.exists()){
    const data = snap.data();
    await setDoc(ref,{
      totalTime: data.totalTime + elapsed,
      sessions: data.sessions + 1,
      studiedLists: Array.from(new Set([...data.studiedLists, listTitle])),
      dontKnowCounts: {
        ...data.dontKnowCounts,
        [listTitle]: (data.dontKnowCounts?.[listTitle] || 0) + dontKnowCount
      }
    },{merge:true});
  }else{
    await setDoc(ref,{
      totalTime: elapsed,
      sessions: 1,
      studiedLists: [listTitle],
      dontKnowCounts: {[listTitle]: dontKnowCount},
      createdAt: serverTimestamp()
    });
  }
}

  
// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

// ================= å…±é€šCSVèª­ã¿è¾¼ã¿ =================
async function loadCSV(path){
  const res = await fetch(path);
  const text = await res.text();
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",");

  return lines.slice(1).map(line=>{
    const values=line.split(",");
    let obj={};
    headers.forEach((h,i)=>obj[h.trim()]=values[i]?.trim());
    return obj;
  });
}

// ================= ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿ =================
async function loadAllLists(){
  const basic = await loadCSV("lists/index.csv");
  const inter = await loadCSV("lists2/index.csv");

  createButtons(basic,"lists","basicList");
  createButtons(inter,"lists2","intermediateList");

  show("listScreen");
}

function createButtons(data,folder,containerId){
  const c=document.getElementById(containerId);
  c.innerHTML="";
  data.forEach(item=>{
    const b=document.createElement("button");
    b.className="btn-blue";
    b.innerText=item.title;
    b.onclick=()=>startStudy(folder,item.title,item.file);
    c.appendChild(b);
  });
}

// ================= å­¦ç¿’ãƒ­ã‚¸ãƒƒã‚¯ =================
let currentList=[], order=[], index=0, dontKnow=[];
let title="", round=1;

async function startStudy(folder,titleName,file){
  const csv=await loadCSV(`${folder}/${file}`);
  currentList=csv;
  title=titleName;
  round=1; index=0; dontKnow=[];
  resetOrder();
  show("studyScreen");
  nextQuestion();
}

function resetOrder(){
  order=[...currentList.keys()].sort(()=>Math.random()-0.5);
  index=0;
}

function nextQuestion(){
  if(index>=order.length){
    if(dontKnow.length===0){
      alert("ã™ã¹ã¦æ­£è§£ã§ã™ï¼");
      loadAllLists();
      return;
    }
    currentList=dontKnow.map(i=>currentList[i]);
    dontKnow=[];
    round++;
    resetOrder();
  }

  const item=currentList[order[index]];
  document.getElementById("questionWord").innerText=item.word;
  document.getElementById("answerMeaning").innerText="";
  document.getElementById("statusText").innerText=`${title}ï¼ˆ${round}å·¡ç›®ï¼‰`;

  const img=document.getElementById("wordImage");
  if(item.image){
    img.src="images/"+item.image;
    img.style.display="block";
  }else{
    img.style.display="none";
  }
}

// ================= å›ç­” =================
function markKnow(){
  showAnswer();
  setTimeout(()=>{ index++; nextQuestion(); },800);
}

function markDontKnow(){
  dontKnow.push(order[index]);
  showAnswer();
  setTimeout(()=>{ index++; nextQuestion(); },1800);
}

function showAnswer(){
  document.getElementById("answerMeaning").innerText=
    currentList[order[index]].meaning;
  speakAnswer();
}

// ================= éŸ³å£° =================
function speakQuestion(){
  speak(document.getElementById("questionWord").innerText);
}
function speakAnswer(){
  speak(document.getElementById("answerMeaning").innerText);
}
function speak(text){
  if(!text) return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  speechSynthesis.speak(u);
}

// ================= ç”»é¢åˆ¶å¾¡ =================
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}
function endStudy(){
  if(confirm("å­¦ç¿’ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")) loadAllLists();
}

// åˆæœŸèµ·å‹•
loadAllLists();
</script>
  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  
</body>
</html>

