<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff5fb;
  padding:2vw;
}
.screen{ display:none; }
.card{
  background:white;
  padding:3vw;
  border-radius:18px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  margin-bottom:4vw;
}
button{
  padding:2.5vw 4vw;
  border-radius:20px;
  border:none;
  font-size:4vw;
  margin:1vw;
}
.btn-blue{ background:#9bd8ff; }
.btn-green{ background:#9be1a7; }
.btn-pink{ background:#ff9bcd; }
.btn-gray{ background:#dddddd; }
.big{
  font-size:7vw;
  margin:3vw 0;
  text-align:center;
  cursor:pointer;
}
#wordImage{
  max-width:70%;
  display:none;
  margin:3vw auto;
}
#infoBar{
  position:fixed;
  bottom:1.5vw;
  right:1.5vw;
  background:rgba(255,255,255,0.9);
  border-radius:12px;
  padding:1.5vw 2vw;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
#studyInfo{
  font-size:3vw;
  color:#555;
}
</style>
</head>

<body>

<div id="listScreen" class="screen card">
  <h3>ğŸ“˜ åŸºæœ¬</h3>
  <div id="basicList"></div>

  <h3>ğŸ“• ä¸­ç´š</h3>
  <div id="intermediateList"></div>

  <h3>ğŸ“Š å­¦ç¿’æ™‚é–“ï¼ˆæ—¥åˆ¥ï¼‰</h3>
  <canvas id="studyChart" width="320" height="200"></canvas>
</div>

<div id="studyScreen" class="screen card">
  <div class="big" id="questionWord" onclick="speakQuestion()"></div>
  <div class="big" id="answerMeaning" style="color:#0077ff;"
       onclick="speakAnswer()"></div>

  <button class="btn-green" onclick="markKnow()">åˆ†ã‹ã‚‹</button>
  <button class="btn-pink" onclick="markDontKnow()">åˆ†ã‹ã‚‰ãªã„</button>
  <button class="btn-gray" onclick="endStudy()">çµ‚äº†</button>
</div>

<div id="infoBar">
  <div>ğŸŒ¸ è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026 ğŸŒ¸</div>
  <div id="studyInfo"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ===== Firebase åˆæœŸåŒ– =====
firebase.initializeApp({
  apiKey: "AIzaSyAYEEHtYUdDylKlSwy4mX2S2mIK5Hs3vJA",
  authDomain: "english-word-app-f7101.firebaseapp.com",
  projectId: "english-word-app-f7101",
});
const db = firebase.firestore();

// ===== userId =====
let userId = localStorage.getItem("userId");
if(!userId){
  userId = crypto.randomUUID();
  localStorage.setItem("userId", userId);
}

// ===== æ™‚é–“ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
let studyStartTime = null;
const today = () => new Date().toISOString().slice(0,10);
const formatTime = sec => {
  const m = Math.floor(sec/60);
  const h = Math.floor(m/60);
  return h ? `${h}æ™‚é–“${m%60}åˆ†` : `${m}åˆ†`;
};

// ===== CSV =====
async function loadCSV(path){
  const res = await fetch(path);
  let text = await res.text();
  text = text.replace(/^\uFEFF/, "");
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",").map(h=>h.trim());
  return lines.slice(1).map(l=>{
    const v=l.split(",");
    let o={};
    headers.forEach((h,i)=>o[h]=v[i]?v[i].trim():"");
    return o;
  });
}

// ===== Firestoreå‡¦ç†ï¼ˆçœç•¥ã›ãšå…ƒã®ã¾ã¾ï¼‰ =====
// â€¦â€¦ï¼ˆä¸­ç•¥ï¼šå…ƒã‚³ãƒ¼ãƒ‰ã¨å®Œå…¨åŒä¸€ï¼‰â€¦â€¦

// ===== éŸ³å£°ï¼ˆâ˜…ä¿®æ­£ç®‡æ‰€ï¼‰ =====
function speak(text, lang){
  if(!text) return;
  speechSynthesis.cancel();          // â˜… å¿…é ˆ
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  speechSynthesis.speak(u);
}
function speakQuestion(){
  speak(questionWord.innerText, "en-US");
}
function speakAnswer(){
  speak(answerMeaning.innerText, "ja-JP");
}

// ===== ç”»é¢åˆ¶å¾¡ï¼ˆå…ƒã®ã¾ã¾ï¼‰ =====
// â€¦â€¦çœç•¥â€¦â€¦

// èµ·å‹•
loadAllLists();
</script>
</body>
</html>
