<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff5fb;
  padding:2vw;
}

.screen{ display:none; }

.card{
  background:white;
  padding:3vw;
  border-radius:18px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  margin-bottom:4vw;
}

#topMenu{
  position:fixed;
  top:1vw;
  right:1vw;
  z-index:100;
}

#topMenu button{ margin-left:1vw; }

button{
  padding:2.2vw 3.5vw;
  border-radius:20px;
  border:none;
  font-size:3.5vw;
  margin:1vw;
}

.btn-pink{ background:#ff9bcd; }
.btn-green{ background:#9be1a7; }
.btn-blue{ background:#9bd8ff; }
.btn-gray{ background:#dddddd; }

.big{
  font-size:6vw;
  margin:3vw 0;
  cursor:pointer;
  text-align:center;
}

#wordImage{
  max-width:70%;
  display:none;
  margin:3vw auto;
  cursor:pointer;
}

#infoBar{
  position:fixed;
  bottom:1.5vw;
  right:1.5vw;
  background:rgba(255,255,255,0.9);
  border-radius:12px;
  padding:1.2vw 1.8vw;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  text-align:right;
  z-index:200;
}

#appName{
  font-size:2.2vw;
  color:#ff7eb8;
}

#statusText{
  font-size:2.6vw;
  color:#555;
}

@media (max-width: 600px){
  button{
    font-size:5vw;
    padding:3vw 5vw;
  }
  .big{ font-size:9vw; }
  #appName{ font-size:3vw; }
  #statusText{ font-size:3.8vw; }
}
</style>
</head>

<body>

<div id="topMenu">
  <button class="btn-blue" onclick="pauseStudy()">ä¸­æ–­</button>
  <button class="btn-gray" onclick="confirmEnd()">çµ‚äº†</button>
</div>

<div id="listScreen" class="screen card">
  <h3>ğŸ“š ãƒªã‚¹ãƒˆã‚’é¸ã‚“ã§ã­</h3>
  <div id="listContainer"></div>
</div>

<div id="studyScreen" class="screen card">
  <div class="big" id="questionWord" onclick="speakText('question')"></div>
  <img id="wordImage" onclick="speakText('question')">
  <div class="big" id="answerMeaning"
       style="color:#0077ff;"
       onclick="speakText('answer')"></div>

  <button class="btn-green" onclick="markKnow()">åˆ†ã‹ã‚‹</button>
  <button class="btn-pink" onclick="markDontKnow()">åˆ†ã‹ã‚‰ãªã„</button>
</div>

<div id="pauseScreen" class="screen card">
  <h3>â¸ ä¸­æ–­ä¸­</h3>
  <button class="btn-green" onclick="resumeStudy()">å†é–‹</button>
  <button class="btn-gray" onclick="confirmEnd()">çµ‚äº†</button>
</div>

<div id="infoBar">
  <div id="appName">ğŸŒ¸ è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026 ğŸŒ¸</div>
  <div id="statusText"></div>
</div>

<script>
const lists = [
  { title:"å‹•ç‰©", file:"å‹•ç‰©.csv" },
  { title:"ãƒ•ãƒ«ãƒ¼ãƒ„", file:"ãƒ•ãƒ«ãƒ¼ãƒ„.csv" },
  { title:"ã‚¹ãƒãƒ¼ãƒ„", file:"ã‚¹ãƒãƒ¼ãƒ„.csv" },
  { title:"å­¦æ ¡ç”Ÿæ´»", file:"å­¦æ ¡ç”Ÿæ´».csv" },
  { title:"ä¼‘æ—¥", file:"ä¼‘æ—¥.csv" },
  { title:"æœˆã®åå‰", file:"æœˆã®åå‰.csv" },
  { title:"æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³", file:"æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³.csv" },
  { title:"å¤œã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³", file:"å¤œã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³.csv" },
  { title:"æ–‡åŒ–éƒ¨", file:"æ–‡åŒ–éƒ¨.csv" },
  { title:"æ›œæ—¥", file:"æ›œæ—¥.csv" }
];

let currentList=[], title="", order=[], index=0;
let dontKnow=[], round=1, fullRoundCount=0;

function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

async function loadCSV(file){
  const res = await fetch("lists/" + file);
  const text = await res.text();
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",");
  return lines.slice(1).map(line=>{
    const values=line.split(",");
    let o={};
    headers.forEach((h,i)=>o[h.trim()]=values[i]?.trim());
    return o;
  });
}

function loadLists(){
  const c=document.getElementById("listContainer");
  c.innerHTML="";
  lists.forEach((l,i)=>{
    const b=document.createElement("button");
    b.className="btn-blue";
    b.innerText=l.title;
    b.onclick=()=>startStudy(i);
    c.appendChild(b);
  });
  document.getElementById("statusText").innerText="";
  show("listScreen");
}

async function startStudy(i){
  const csv=await loadCSV(lists[i].file);
  currentList=csv.map(x=>({word:x.word,meaning:x.meaning,image:x.image}));
  title=lists[i].title;
  index=0; round=1; fullRoundCount=0; dontKnow=[];
  resetOrder();
  show("studyScreen");
  nextQuestion();
}

function resetOrder(){
  order=[...currentList.keys()].sort(()=>Math.random()-0.5);
  index=0;
}

function nextQuestion(){
  if(index>=order.length){
    fullRoundCount++;
    if(dontKnow.length===0 && confirm("é–“é•ã„ãŒãªããªã‚Šã¾ã—ãŸã€‚\nçµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")){
      loadLists(); return;
    }
    if(fullRoundCount>=3){
      alert("3å›ç¹°ã‚Šè¿”ã—ãŸã®ã§çµ‚äº†ã—ã¾ã™ã€‚");
      loadLists(); return;
    }
    currentList=dontKnow.map(i=>currentList[i]);
    dontKnow=[]; round++; resetOrder();
  }

  const item=currentList[order[index]];
  document.getElementById("questionWord").innerText=item.word;
  document.getElementById("answerMeaning").innerText="";
  document.getElementById("statusText").innerText=`${title}ï¼ˆ${round}å·¡ç›®ï¼‰`;

  const img=document.getElementById("wordImage");
  if(item.image){ img.src="images/"+item.image; img.style.display="block"; }
  else{ img.style.display="none"; }
}

function markKnow(){
  document.getElementById("answerMeaning").innerText=currentList[order[index]].meaning;
  setTimeout(()=>{ index++; nextQuestion(); },800);
}

function markDontKnow(){
  dontKnow.push(order[index]);
  document.getElementById("answerMeaning").innerText=currentList[order[index]].meaning;
  setTimeout(()=>{ index++; nextQuestion(); },1700);
}

function pauseStudy(){ show("pauseScreen"); }
function resumeStudy(){ show("studyScreen"); }

function confirmEnd(){
  if(confirm("ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")) loadLists();
}

function speakText(type){
  const text = type==="answer"
    ? document.getElementById("answerMeaning").innerText
    : document.getElementById("questionWord").innerText;
  if(!text) return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";
  speechSynthesis.speak(u);
}

loadLists();
</script>
</body>
</html>
