<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff5fb;
  padding:15px;
}

h2{ color:#ff7eb8; }

.screen{ display:none; }

.card{
  background:white;
  padding:15px;
  border-radius:18px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  margin-bottom:15px;
}

/* ===== ä¸Šéƒ¨å›ºå®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ ===== */
#topMenu{
  position:fixed;
  top:10px;
  right:10px;
  z-index:100;
}

#topMenu button{
  margin-left:5px;
}

button{
  padding:10px 14px;
  border-radius:20px;
  border:none;
  font-size:14px;
}

.btn-pink{ background:#ff9bcd; }
.btn-green{ background:#9be1a7; }
.btn-blue{ background:#9bd8ff; }
.btn-gray{ background:#dddddd; }

.big{
  font-size:5vw;
  margin:12px 0;
  cursor:pointer;
}

#wordImage{
  max-width:60%;
  display:none;
  margin:10px auto;
}

/* ===== ã‚¹ãƒãƒ›æœ€é©åŒ– ===== */
@media (max-width: 600px){
  .big{
    font-size:8vw;
  }
  button{
    font-size:16px;
    padding:12px 16px;
  }
}
</style>
</head>

<body>

<h2>ğŸŒ¸ è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026 ğŸŒ¸</h2>

<!-- ===== ä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ===== -->
<div id="topMenu">
  <button class="btn-blue" onclick="pauseStudy()">ä¸­æ–­</button>
  <button class="btn-gray" onclick="endStudy()">çµ‚äº†</button>
</div>

<!-- ===== ãƒªã‚¹ãƒˆé¸æŠ ===== -->
<div id="listScreen" class="screen card">
  <h3>ğŸ“š ãƒªã‚¹ãƒˆã‚’é¸ã‚“ã§ã­</h3>
  <div id="listContainer"></div>
</div>

<!-- ===== å­¦ç¿’ç”»é¢ ===== -->
<div id="studyScreen" class="screen card">
  <h3 id="studyTitle"></h3>

  <div class="big" id="questionWord" onclick="speakText()"></div>

  <img id="wordImage">

  <div class="big" id="answerMeaning" style="color:#0077ff;"></div>

  <button class="btn-green" onclick="markKnow()">åˆ†ã‹ã‚‹</button>
  <button class="btn-pink" onclick="markDontKnow()">åˆ†ã‹ã‚‰ãªã„</button>
</div>

<!-- ===== ä¸­æ–­ç”»é¢ ===== -->
<div id="pauseScreen" class="screen card">
  <h3>â¸ ä¸­æ–­ä¸­</h3>
  <button class="btn-green" onclick="resumeStudy()">å†é–‹</button>
  <button class="btn-gray" onclick="endStudy()">çµ‚äº†</button>
</div>

<script>
// ===== ãƒªã‚¹ãƒˆæƒ…å ± =====
const lists = [
  { title:"å‹•ç‰©", file:"animals.csv" },
  { title:"æœç‰©", file:"fruits.csv" }
];

// ===== çŠ¶æ…‹ =====
let currentList=[];
let title="";
let order=[];
let index=0;
let dontKnow=[];
let round=1;
let fullRoundCount=0;

// ===== ç”»é¢åˆ‡æ›¿ =====
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

// ===== CSVèª­ã¿è¾¼ã¿ =====
async function loadCSV(file){
  const res=await fetch("lists/"+file);
  const text=await res.text();
  const lines=text.trim().split("\n");
  const headers=lines[0].split(",");
  const items=[];
  for(let i=1;i<lines.length;i++){
    const values=lines[i].split(",");
    let obj={};
    headers.forEach((h,j)=>obj[h.trim()]=values[j].trim());
    items.push(obj);
  }
  return items;
}

// ===== ãƒªã‚¹ãƒˆè¡¨ç¤º =====
function loadLists(){
  const c=document.getElementById("listContainer");
  c.innerHTML="";
  lists.forEach((l,i)=>{
    const btn=document.createElement("button");
    btn.className="btn-blue";
    btn.innerText=l.title;
    btn.onclick=()=>startStudy(i);
    c.appendChild(btn);
  });
  show("listScreen");
}

// ===== å­¦ç¿’é–‹å§‹ =====
async function startStudy(i){
  const info=lists[i];
  const csv=await loadCSV(info.file);
  currentList=csv.map(x=>({
    word:x.word,
    meaning:x.meaning,
    image:x.image
  }));
  title=info.title;
  index=0;
  round=1;
  fullRoundCount=0;
  dontKnow=[];
  resetOrder();
  show("studyScreen");
  nextQuestion();
}

function resetOrder(){
  order=[...currentList.keys()];
  order.sort(()=>Math.random()-0.5);
  index=0;
}

// ===== å‡ºé¡Œ =====
function nextQuestion(){
  if(index>=order.length){
    fullRoundCount++;
    if(dontKnow.length===0){
      if(confirm("é–“é•ã„ãŒãªããªã‚Šã¾ã—ãŸã€‚\nçµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")){
        loadLists(); return;
      }
    }
    if(fullRoundCount>=3){
      alert("3å›ç¹°ã‚Šè¿”ã—ãŸã®ã§çµ‚äº†ã—ã¾ã™ã€‚");
      loadLists(); return;
    }
    currentList=dontKnow.map(i=>currentList[i]);
    dontKnow=[];
    round++;
    resetOrder();
  }

  const item=currentList[order[index]];
  document.getElementById("studyTitle").innerText=`${title}ï¼ˆ${round}å·¡ç›®ï¼‰`;
  document.getElementById("questionWord").innerText=item.word;
  document.getElementById("answerMeaning").innerText="";

  const img=document.getElementById("wordImage");
  if(item.image){
    img.src="images/"+item.image;
    img.style.display="block";
  }else{
    img.style.display="none";
  }
}

// ===== å›ç­” =====
function markKnow(){
  document.getElementById("answerMeaning").innerText=
    currentList[order[index]].meaning;
  setTimeout(()=>{ index++; nextQuestion(); },800);
}

function markDontKnow(){
  dontKnow.push(order[index]);
  document.getElementById("answerMeaning").innerText=
    currentList[order[index]].meaning;
  setTimeout(()=>{ index++; nextQuestion(); },1200);
}

// ===== ä¸­æ–­ãƒ»å†é–‹ãƒ»çµ‚äº† =====
function pauseStudy(){
  show("pauseScreen");
}

function resumeStudy(){
  show("studyScreen");
}

function endStudy(){
  if(confirm("æœ¬å½“ã«çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")){
    loadLists();
  }
}

// ===== éŸ³å£° =====
function speakText(){
  const t=document.getElementById("questionWord").innerText;
  if(!t) return;
  const u=new SpeechSynthesisUtterance(t);
  u.lang="en-US";
  speechSynthesis.speak(u);
}

// åˆæœŸè¡¨ç¤º
loadLists();
</script>
</body>
</html>
