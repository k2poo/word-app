<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#fff5fb;
  padding:2vw;
}

/* ===== ç”»é¢å…±é€š ===== */
.screen{ display:none; }

.card{
  background:white;
  padding:3vw;
  border-radius:18px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
  margin-bottom:4vw;
}

/* ===== ä¸Šéƒ¨å›ºå®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ ===== */
#topMenu{
  position:fixed;
  top:1vw;
  right:1vw;
  z-index:100;
}

#topMenu button{
  margin-left:1vw;
}

/* ===== ãƒœã‚¿ãƒ³å…±é€š ===== */
button{
  padding:2.2vw 3.5vw;
  border-radius:20px;
  border:none;
  font-size:3.5vw;
  margin:1vw;
}

.btn-pink{ background:#ff9bcd; }
.btn-green{ background:#9be1a7; }
.btn-blue{ background:#9bd8ff; }
.btn-gray{ background:#dddddd; }

/* ===== å˜èªè¡¨ç¤º ===== */
.big{
  font-size:6vw;
  margin:3vw 0;
  cursor:pointer;
  text-align:center;
}

/* ===== ç”»åƒ ===== */
#wordImage{
  max-width:70%;
  display:none;
  margin:3vw auto;
  cursor:pointer;
}

/* ===== å³ä¸‹å›ºå®š æƒ…å ±ãƒãƒ¼ ===== */
#infoBar{
  position:fixed;
  bottom:1.5vw;
  right:1.5vw;
  background:rgba(255,255,255,0.9);
  border-radius:12px;
  padding:1.2vw 1.8vw;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  text-align:right;
  z-index:200;
}

#appName{
  font-size:2.2vw;
  color:#ff7eb8;
}

#statusText{
  font-size:2.6vw;
  color:#555;
}

/* ===== ã‚¹ãƒãƒ›ç¸¦ç”»é¢å¯¾å¿œ ===== */
@media (max-width: 600px){
  button{
    font-size:5vw;
    padding:3vw 5vw;
  }

  .big{
    font-size:9vw;
  }

  #appName{
    font-size:3vw;
  }

  #statusText{
    font-size:3.8vw;
  }
}
</style>
</head>

<body>

<!-- ===== ä¸Šéƒ¨å›ºå®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ ===== -->
<div id="topMenu">
  <button class="btn-blue" onclick="pauseStudy()">ä¸­æ–­</button>
  <button class="btn-gray" onclick="confirmEnd()">çµ‚äº†</button>
</div>

<!-- ===== ãƒªã‚¹ãƒˆé¸æŠç”»é¢ ===== -->
<div id="listScreen" class="screen card">
  <h3>ğŸ“š ãƒªã‚¹ãƒˆã‚’é¸ã‚“ã§ã­</h3>
  <div id="listContainer"></div>
</div>

<!-- ===== å­¦ç¿’ç”»é¢ ===== -->
<div id="studyScreen" class="screen card">
  <h3></h3>

  <div class="big" id="questionWord" onclick="speakText()"></div>

  <img id="wordImage" onclick="speakText()">

  <div class="big" id="answerMeaning" style="color:#0077ff;"></div>

  <button class="btn-green" onclick="markKnow()">åˆ†ã‹ã‚‹</button>
  <button class="btn-pink" onclick="markDontKnow()">åˆ†ã‹ã‚‰ãªã„</button>
</div>

<!-- ===== ä¸­æ–­ç”»é¢ ===== -->
<div id="pauseScreen" class="screen card">
  <h3>â¸ ä¸­æ–­ä¸­</h3>
  <button class="btn-green" onclick="resumeStudy()">å†é–‹</button>
  <button class="btn-gray" onclick="confirmEnd()">çµ‚äº†</button>
</div>

<!-- ===== å³ä¸‹å›ºå®š æƒ…å ±è¡¨ç¤º ===== -->
<div id="infoBar">
  <div id="appName">ğŸŒ¸ è‹±å˜èªæš—è¨˜ã‚¢ãƒ—ãƒª by Koji NIHEI 2026 ğŸŒ¸</div>
  <div id="statusText"></div>
</div>

<script>
// ===== ãƒªã‚¹ãƒˆæƒ…å ± =====
const lists = [
  { title:"å‹•ç‰©", file:"animals.csv" },
  { title:"æœç‰©", file:"fruits.csv" }
];

// ===== çŠ¶æ…‹ =====
let currentList=[];
let title="";
let order=[];
let index=0;
let dontKnow=[];
let round=1;
let fullRoundCount=0;

// ===== ç”»é¢åˆ‡æ›¿ =====
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

// ===== CSVèª­ã¿è¾¼ã¿ =====
async function loadCSV(file){
  const res = await fetch("lists/" + file);
  const text = await res.text();
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",");
  const items = [];

  for(let i=1;i<lines.length;i++){
    const values = lines[i].split(",");
    let obj = {};
    headers.forEach((h,j)=>obj[h.trim()] = values[j].trim());
    items.push(obj);
  }
  return items;
}

// ===== ãƒªã‚¹ãƒˆè¡¨ç¤º =====
function loadLists(){
  const c = document.getElementById("listContainer");
  c.innerHTML = "";

  lists.forEach((l,i)=>{
    const btn = document.createElement("button");
    btn.className = "btn-blue";
    btn.innerText = l.title;
    btn.onclick = ()=>startStudy(i);
    c.appendChild(btn);
  });

  document.getElementById("statusText").innerText = "";
  show("listScreen");
}

// ===== å­¦ç¿’é–‹å§‹ =====
async function startStudy(i){
  const info = lists[i];
  const csv = await loadCSV(info.file);

  currentList = csv.map(x=>({
    word:x.word,
    meaning:x.meaning,
    image:x.image
  }));

  title = info.title;
  index = 0;
  round = 1;
  fullRoundCount = 0;
  dontKnow = [];

  resetOrder();
  show("studyScreen");
  nextQuestion();
}

function resetOrder(){
  order = [...currentList.keys()];
  order.sort(()=>Math.random()-0.5);
  index = 0;
}

// ===== å‡ºé¡Œ =====
function nextQuestion(){
  if(index >= order.length){
    fullRoundCount++;

    if(dontKnow.length === 0){
      if(confirm("é–“é•ã„ãŒãªããªã‚Šã¾ã—ãŸã€‚\nçµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")){
        loadLists();
        return;
      }
    }

    if(fullRoundCount >= 3){
      alert("3å›ç¹°ã‚Šè¿”ã—ãŸã®ã§çµ‚äº†ã—ã¾ã™ã€‚");
      loadLists();
      return;
    }

    currentList = dontKnow.map(i=>currentList[i]);
    dontKnow = [];
    round++;
    resetOrder();
  }

  const item = currentList[order[index]];

  document.getElementById("questionWord").innerText = item.word;
  document.getElementById("answerMeaning").innerText = "";

  document.getElementById("statusText").innerText =
    `${title}ï¼ˆ${round}å·¡ç›®ï¼‰`;

  const img = document.getElementById("wordImage");
  if(item.image){
    img.src = "images/" + item.image;
    img.style.display = "block";
  }else{
    img.style.display = "none";
  }
}

// ===== å›ç­” =====
function markKnow(){
  document.getElementById("answerMeaning").innerText =
    currentList[order[index]].meaning;
  setTimeout(()=>{ index++; nextQuestion(); },800);
}

function markDontKnow(){
  dontKnow.push(order[index]);
  document.getElementById("answerMeaning").innerText =
    currentList[order[index]].meaning;
  setTimeout(()=>{ index++; nextQuestion(); },1200);
}

// ===== ä¸­æ–­ãƒ»å†é–‹ãƒ»çµ‚äº† =====
function pauseStudy(){ show("pauseScreen"); }
function resumeStudy(){ show("studyScreen"); }

function confirmEnd(){
  if(confirm("ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ")){
    loadLists();
  }
}

// ===== éŸ³å£° =====
function speakText(){
  const text = document.getElementById("questionWord").innerText;
  if(!text) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

// åˆæœŸè¡¨ç¤º
loadLists();
</script>

</body>
</html>
